## Kubernetesとは

[Kubernetes Overview](Infrastructure/Kubernetes/images/overview.png)

Kubernetesはコンテナのオーケストラレーションツールである

`kubectl` コマンドを使ってコンテナを操作する

## Clusterとは

マスターコンポーネントのセットでシステム全体とコンテナを管理する。
KubernetesがPod内のコンテナをスケジュールできるマシンのグループ。
クラスタ内のマシンはノードと呼ばれる。

## Pod

最小デプロイ単位で、クラスタの実行プロセスのこと。
また、1つ以上のコンテナのグループを指す。通常一つのPodに1つのコンテナだが、複数のコンテナを持つことも可能。

各Podには固有のIPを持つ。
Pod内のコンテナはローカルホストでの通信が可能。

PodはリリースのたびにIPアドレスが変わる。

## Deployment

同じPodのレプリカのグループ。
ノードのいずれかで障害が起こったときに、対応できる。

DeploymentのPodを一般公開するには、ロードバランサー(Service)を追加して、固定IPアドレスにアクセスする。

## Service

一連のPodをグループ化して安定したエンドポイントを提供するもの。

## Kubernetesのコンセプト

- Kubernetesオブジェクトモデル
  - 各管理対象はオブジェクトによって表せれその属性と状態の表示や変更が可能
- 宣言型管理の原則
  - watchループによって現状と、望ましい状態との比較によって状態管理を行う

## コントロールプレーン

[Kubernetes Cluster Image](Infrastructure/Kubernetes/images/clusterImage.png)

- コントロールプレーンの役割はクラスタ全体の調整
- コントロールプレーンが管理するコンポーネント
  - Kube APIサーバー
    - Podの起動などのクラスタの状態を表示、変更するコマンドを受け付ける役割
    - ユーザーがKubectlコマンドを利用して操作することで、Kubernetes全体の制御が可能
    - 受け取ったリクエストを認証し、認可済みで有効であるかどうかを判断してアドミッションコントロールを管理する
  - etcd
    - クラスタのデータベースで、クラスタの状態を保存する
      - クラスタのすべての構成データ、クラスタに含まれているノード、実行されるべきPod、実行されるべき場所などの情報が含まれている
      - ユーザーが直接操作することはなく、Kube APIサーバーを介して操作する
  - kube-scheduler
    - Podをノードにスケジューリングする
    - すべてのノードの状態を把握しているため、定義されたポリシーの成約に従って実行する
      - 一定の容量のメモリがあるノードでのみ実行を許可することができる
      - アフィニティの使用を定義して一連のPodが同じノードで実行されるように、あるいはアンチアフィニティの使用を定義してPodが同じノードで実行されないようにしたりできる
  - kube-controller-manger
    - Kube APIサーバー経由でクラスタの状態を継続的にモニタリングする
    - クラスタの状態が望ましくない場合、望ましい状態を実現するための変更を行う
    - コントロラーのループによって状態を常に監視している
  - node-controller
    - ノードがオフラインのときのモニタリングと対処
  - kube-cloud-manager
    - 基盤となるクラウドプロバイダとやり取りするコントローラーを管理
  - kubelt
    - 各ノード上でKubernetesエージェントとして常駐
